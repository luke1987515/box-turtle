注意：此份文件由 Google Gemini 生成

這份 README 是專為你提供的 PowerShell 腳本所設計，旨在幫助測試人員快速了解腳本功能、環境需求及使用方法。

# ---

**Power Cycle & Storage Stress Test Tool**

這是一個自動化測試腳本，專為伺服器硬體壓力測試設計。透過 **IPMI** 控制伺服器反覆進行開關機循環（Power Cycle），並在每次開機後自動檢測作業系統是否正確識別預期數量的 **Physical Disks**。

## **核心功能**

* **自動化循環測試**：預設執行 300 次開關機測試，無需人工干預。  
* **動態磁碟掃描**：透過 Get-PhysicalDisk 即時掃描系統中的硬碟數量（過濾可加入儲存池的磁碟）。  
* **智能重試機制**：若偵測到的磁碟數量不符，腳本會以遞增的時間間隔（10s, 20s, 30s...）進行無限次重試，確保系統完整啟動。  
* **詳細日誌記錄**：每次循環皆會記錄啟動時間、檢測耗時及詳細的硬碟資訊（DeviceId, SerialNumber, Size）。

## **前置準備**

1. **環境需求**：  
   * Windows 10 / Windows Server 2016 或更高版本。  
   * 以 **系統管理員權限** 執行 PowerShell。  
2. **相依工具**：  
   * **ipmitool.exe**：請確保腳本目錄下存在此執行檔，用於發送遠端電源指令。  
3. **遠端伺服器配置**：  
   * 目標伺服器的 BMC IP 需設定為 192.168.11.11（或依需求修改腳本內容）。  
   * BMC 帳號：admin / 密碼：admin123。

## **使用步驟**

1. **下載並存放**：將腳本與 ipmitool.exe 放在同一個資料夾。  
2. 啟動腳本：  
   右鍵點擊腳本並選擇「使用 PowerShell 執行」，或在終端機輸入：  
   PowerShell  
   .\\YourScriptName.ps1

3. 輸入參數：  
   腳本會提示輸入「預期的磁碟數量」，請根據伺服器實際搭載的硬碟總數輸入數字（例如：78）。  
4. **監控過程**：  
   * **綠色文字**：代表磁碟數量正確，進入下一次循環。  
   * **紅色文字**：代表磁碟數量缺失，腳本正自動重試。  
   * **黃色文字**：代表正在發送 IPMI 電源指令。

## **邏輯流程說明**

| 階段 | 動作 | 等待時間 |
| :---- | :---- | :---- |
| **Power Off** | 關閉目標伺服器電源 | 60 秒 |
| **Power On** | 開啟目標伺服器電源 | 120 秒 (基礎開機) |
| **Disk Check** | 檢查 Get-PhysicalDisk 數量 | 若不符則進入重試迴圈 |
| **Logging** | 寫入 PowerCycleTest\_日期.log | 即時寫入 |

## **檔案結構**

* PowerCycleTest\_YYYYMMDD\_HHmm.log：存放在腳本目錄下，記錄每次測試的詳細結果與錯誤警告。

## **注意事項**

* **網路連線**：請確保測試機與目標伺服器的 BMC 網路孔連線正常。  
* **修改 IP**：若 BMC IP 不同，請手動修改腳本第 37 與 44 行的 IP 位址。

---

**您是否需要我為您在腳本中加入「中斷後自動接續測試」的功能，以防測試中途意外停止？**